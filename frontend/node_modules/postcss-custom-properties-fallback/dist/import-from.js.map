{"version":3,"file":"import-from.js","sources":["../src/import-from.js"],"sourcesContent":["const fs = require('fs');\nconst path = require('path');\nconst postcss = require('postcss');\nconst { parse } = require('postcss-values-parser');\n\nasync function getCustomPropertiesFromCSSFile(from) {\n  const css = await readFile(from);\n  // eslint-disable-next-line no-unused-vars\n  const root = postcss.parse(css, { from });\n\n  throw new Error('Importing from CSS files not supported yet');\n  //return getCustomPropertiesFromRoot(root, { preserve: true });\n}\n\n/* Get Custom Properties from Object\n/* ========================================================================== */\n\nfunction getCustomPropertiesFromObject(object) {\n  const customProperties = Object.assign(\n    {},\n    Object(object).customProperties,\n    Object(object)['custom-properties']\n  );\n\n  for (const key in customProperties) {\n    customProperties[key] = parse(String(customProperties[key])).nodes;\n  }\n\n  return customProperties;\n}\n\n/* Get Custom Properties from JSON file\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromJSONFile(from) {\n  const object = await readJSON(from);\n\n  return getCustomPropertiesFromObject(object);\n}\n\n/* Get Custom Properties from JS file\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromJSFile(from) {\n  const object = require(from);\n\n  return getCustomPropertiesFromObject(object);\n}\n\nmodule.exports = function getCustomPropertiesFromImports(sources) {\n  return sources\n    .map((source) => {\n      if (source instanceof Promise) {\n        return source;\n      } else if (source instanceof Function) {\n        return source();\n      }\n\n      // read the source as an object\n      const opts =\n        source === Object(source) ? source : { from: String(source) };\n\n      // skip objects with Custom Properties\n      if (opts.customProperties || opts['custom-properties']) {\n        return opts;\n      }\n\n      // source pathname\n      const from = path.resolve(String(opts.from || ''));\n\n      // type of file being read from\n      const type = (opts.type || path.extname(from).slice(1)).toLowerCase();\n\n      return { type, from };\n    })\n    .reduce(async (customProperties, source) => {\n      const { type, from } = await source;\n\n      if (type === 'css') {\n        return Object.assign(\n          await customProperties,\n          await getCustomPropertiesFromCSSFile(from)\n        );\n      }\n\n      if (type === 'js') {\n        return Object.assign(\n          await customProperties,\n          await getCustomPropertiesFromJSFile(from)\n        );\n      }\n\n      if (type === 'json') {\n        return Object.assign(\n          await customProperties,\n          await getCustomPropertiesFromJSONFile(from)\n        );\n      }\n\n      return Object.assign(\n        await customProperties,\n        await getCustomPropertiesFromObject(await source)\n      );\n    }, {});\n};\n\nconst readFile = (from) =>\n  new Promise((resolve, reject) => {\n    fs.readFile(from, 'utf8', (error, result) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n\nconst readJSON = async (from) => JSON.parse(await readFile(from));\n"],"names":["fs","require","path","postcss","parse","getCustomPropertiesFromCSSFile","from","css","readFile","Error","getCustomPropertiesFromObject","object","customProperties","Object","assign","key","String","nodes","getCustomPropertiesFromJSONFile","readJSON","getCustomPropertiesFromJSFile","module","exports","getCustomPropertiesFromImports","sources","map","source","Promise","Function","opts","resolve","type","extname","slice","toLowerCase","reduce","reject","error","result","JSON"],"mappings":"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"}